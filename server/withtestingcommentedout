package main

import (
	"time"
	"fmt"
	"encoding/json"
	"buffbus/lib"
)
const (
	ROUTES_URL ="http://buffbus.etaspot.net/service.php?service=get_routes&token=TESTING"
	STOPS_URL = "http://buffbus.etaspot.net/service.php?service=get_stops&token=TESTING"
	BUSES_URL = "http://buffbus.etaspot.net/service.php?service=get_vehicles&includeETAData=1&orderedETAArray=1&token=TESTING"
)
func main() {

	routes := lib.Routes{}
	stops := lib.Stops{}
	buses := lib.Vehicles{}

    // error := json.Unmarshal(test_routes, &routes)
    // if error != nil {
    // 	fmt.Println("hi: ",error)
    // }

    // error2 := json.Unmarshal(test_stops, &stops)
    // if error2 != nil {
    // 	panic(error2)
    // }
    //  error3 := json.Unmarshal(test_buses, &buses)
    // if error2 != nil {
    // 	fmt.Println("hi: ",error3)
    // }

    // FinalCreator := FinalCreator{routes:routes,stops:stops,buses:buses}

    // json,err := FinalCreator.CreateFinalJson()
    // if err != nil {
    // 	panic(err)
    // }
    // fmt.Println("Here is the final json: ",string(*json))


	t1 := time.Now()
	client := lib.Client{Url:ROUTES_URL}
	routesBody,err := client.CallToTheJerks()
	if err != nil {
		fmt.Println("Here is the error: ", err)
	}
	client2 := lib.Client{Url:BUSES_URL}
	busesBody,err1 := client2.CallToTheJerks()
	if err1 != nil {
		fmt.Println("Here is the error: ", err1)
	}
	client3 := lib.Client{Url:STOPS_URL}
	stopsBody,err2 := client3.CallToTheJerks()
	if err2 != nil {
		fmt.Println("Here is the error: ", err2)
	}
	
    error := json.Unmarshal(routesBody, &routes)
    if error != nil {
    	fmt.Println("hi: ",error)
    }
    stoperror := json.Unmarshal(stopsBody, &stops)
    if stoperror != nil {
    	fmt.Println("hi2 ",stoperror)
    }
    buserror := json.Unmarshal(busesBody, &buses)
    if buserror != nil {
    	//fmt.Println("hi3: ",buserror)
    }

	FinalCreator := lib.FinalCreator{Routes:routes,Stops:stops,Buses:buses}

    json,err := FinalCreator.CreateFinalJson()
    if err != nil {
    	panic(err)
    }
    t2 := time.Now()

	fmt.Println(t2.Sub(t1))

    fmt.Println("Here is the final json: ",string(*json))
 //    fmt.Println(stop)
 //    fmt.Println(bus)

}